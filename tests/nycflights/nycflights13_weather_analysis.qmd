
---
title: "Weather Impact on NYC Flight Delays"
subtitle: "Analysis of nycflights13 Dataset"
author: "Generated by Databot"
date: "November 4, 2025"
format:
  html:
    embed-resources: true
editor: visual
---

```{r}
library(nycflights13)
```

::: {.callout-note}
This report was generated using artificial intelligence (Claude from Anthropic) under general human direction. At the time of generation, the contents have not been comprehensively reviewed by a human analyst.

<!--
To indicate human review: Delete the line above about contents not being reviewed, and replace this comment with:
The contents have been reviewed and validated by [Your Name], [Your Role] on [Date].
-->
:::

## Introduction

This report analyzes the `nycflights13` package, which contains detailed information about all `r format(nrow(flights), big.mark = ",")` flights that departed from New York City airports (JFK, LGA, and EWR) in 2013. 

The package includes five interconnected datasets:

- **flights**: Detailed flight information including times, delays, and routes
- **weather**: Hourly weather data at NYC airports
- **airlines**: Airline carrier codes and names
- **airports**: Airport metadata including location and timezone
- **planes**: Aircraft metadata including manufacturer and model

Our primary focus is on understanding **how weather conditions affect flight delays**, which has important implications for travelers, airlines, and airport operations.

## Data Exploration

```{r}
#| message: false
library(tidyverse)
library(nycflights13)
```

### Overview of the Flights Dataset

```{r}
# Examine the structure
glimpse(flights)
```

The flights dataset contains `r format(nrow(flights), big.mark = ",")` observations with `r ncol(flights)` variables covering:

- **Temporal data**: year, month, day, departure/arrival times
- **Delay information**: departure and arrival delays in minutes
- **Flight details**: carrier, flight number, tail number
- **Route information**: origin airport, destination, distance
- **Duration**: actual air time

### Summary Statistics

```{r}
summary(flights)
```

**Key observations:**

- Average departure delay: `r round(mean(flights$dep_delay, na.rm = TRUE), 1)` minutes
- Average arrival delay: `r round(mean(flights$arr_delay, na.rm = TRUE), 1)` minutes
- Distance range: `r min(flights$distance)` to `r format(max(flights$distance), big.mark = ",")` miles
- Air time range: `r min(flights$air_time, na.rm = TRUE)` to `r max(flights$air_time, na.rm = TRUE)` minutes

### Missing Data Analysis

```{r}
# Count missing values by column
flights |>
  summarise(across(everything(), ~sum(is.na(.)))) |>
  pivot_longer(everything(), names_to = "variable", values_to = "missing_count") |>
  filter(missing_count > 0) |>
  arrange(desc(missing_count))
```

The dataset has `r sum(is.na(flights$dep_time))` missing departure times and `r sum(is.na(flights$arr_time))` missing arrival times, likely representing cancelled flights.

### Related Tables

```{r}
# Airlines
head(airlines)
```

```{r}
# Airports
head(airports)
```

```{r}
# Planes
head(planes)
```

```{r}
# Weather
head(weather)
```

The weather table is particularly important for our analysis, containing hourly measurements of temperature, humidity, wind speed, precipitation, visibility, and atmospheric pressure.

## Weather Impact on Flight Delays

### Joining Flight and Weather Data

To analyze the relationship between weather and delays, we join the flights data with weather conditions at the time and location of each departure:

```{r}
# Join flights with weather data
flights_weather <- flights |>
  inner_join(weather, by = c("origin", "year", "month", "day", "hour", "time_hour"))

# Remove rows with missing delays
flights_weather_clean <- flights_weather |>
  filter(!is.na(dep_delay))

cat("Merged dataset has", format(nrow(flights_weather_clean), big.mark = ","), "observations\n")
```

### Correlation Analysis

First, let's examine the correlations between weather variables and departure delays:

```{r}
# Calculate correlations
weather_cor <- flights_weather_clean |>
  select(dep_delay, temp, dewp, humid, wind_speed, wind_gust, precip, pressure, visib) |>
  cor(use = "pairwise.complete.obs")

# Display correlations with departure delay
weather_cor[, "dep_delay"] |> 
  sort(decreasing = TRUE) |>
  round(3)
```

**Findings:**

- Weather correlations with delays are relatively weak (all under 0.12 in absolute value)
- **Humidity** shows the strongest positive correlation (`r round(weather_cor["humid", "dep_delay"], 3)`)
- **Pressure** and **visibility** show negative correlations (lower values = more delays)
- The weak correlations suggest weather is one of many factors affecting delays

### Precipitation Impact

Let's categorize precipitation levels and examine their effect on delays:

```{r}
# Analyze delays by precipitation level
precip_summary <- flights_weather_clean |>
  mutate(precip_category = case_when(
    precip == 0 ~ "No precipitation",
    precip <= 0.1 ~ "Light (0-0.1 in)",
    precip <= 0.5 ~ "Moderate (0.1-0.5 in)",
    TRUE ~ "Heavy (>0.5 in)"
  )) |>
  group_by(precip_category) |>
  summarise(
    n_flights = n(),
    mean_delay = mean(dep_delay),
    median_delay = median(dep_delay),
    prop_delayed = mean(dep_delay > 0)
  ) |>
  arrange(desc(mean_delay))

precip_summary
```

**Key insights:**

- Flights with **no precipitation** average only `r round(precip_summary$mean_delay[precip_summary$precip_category == "No precipitation"], 1)` minutes of delay
- **Heavy precipitation** (>0.5 inches) increases average delays to `r round(precip_summary$mean_delay[precip_summary$precip_category == "Heavy (>0.5 in)"], 1)` minutes
- The proportion of delayed flights increases from `r round(100 * precip_summary$prop_delayed[precip_summary$precip_category == "No precipitation"], 1)`% to `r round(100 * precip_summary$prop_delayed[precip_summary$precip_category == "Heavy (>0.5 in)"], 1)`% with heavy precipitation

#### Visualization: Delays by Precipitation

```{r}
#| fig-width: 9
#| fig-height: 6
# Create precipitation categories for visualization
flights_weather_plot <- flights_weather_clean |>
  mutate(precip_category = case_when(
    precip == 0 ~ "No precipitation",
    precip <= 0.1 ~ "Light (0-0.1 in)",
    precip <= 0.5 ~ "Moderate (0.1-0.5 in)",
    TRUE ~ "Heavy (>0.5 in)"
  )) |>
  mutate(precip_category = factor(precip_category, 
                                   levels = c("No precipitation", 
                                             "Light (0-0.1 in)", 
                                             "Moderate (0.1-0.5 in)", 
                                             "Heavy (>0.5 in)")))

# Boxplot of delays by precipitation
ggplot(flights_weather_plot, aes(x = precip_category, y = dep_delay, fill = precip_category)) +
  geom_boxplot(outlier.alpha = 0.1) +
  coord_cartesian(ylim = c(-20, 100)) +
  labs(
    title = "Departure Delays by Precipitation Level",
    x = "Precipitation Category",
    y = "Departure Delay (minutes)",
    fill = "Precipitation"
  ) +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 20, hjust = 1))
```

The boxplot clearly shows that median delays and the overall distribution shift upward as precipitation increases.

### Visibility Impact

Poor visibility can also significantly impact flight operations:

```{r}
# Analyze delays by visibility
visibility_summary <- flights_weather_clean |>
  mutate(visibility_category = case_when(
    visib >= 10 ~ "Clear (10 mi)",
    visib >= 5 ~ "Good (5-10 mi)",
    visib >= 1 ~ "Poor (1-5 mi)",
    TRUE ~ "Very Poor (<1 mi)"
  )) |>
  group_by(visibility_category) |>
  summarise(
    n_flights = n(),
    mean_delay = mean(dep_delay),
    median_delay = median(dep_delay),
    prop_delayed = mean(dep_delay > 0)
  ) |>
  arrange(mean_delay)

visibility_summary
```

**Findings:**

- **Clear visibility** (10 miles): `r round(visibility_summary$mean_delay[visibility_summary$visibility_category == "Clear (10 mi)"], 1)` min average delay
- **Very poor visibility** (<1 mile): `r round(visibility_summary$mean_delay[visibility_summary$visibility_category == "Very Poor (<1 mi)"], 1)` min average delay
- Nearly `r round(100 * visibility_summary$prop_delayed[visibility_summary$visibility_category == "Very Poor (<1 mi)"], 1)`% of flights experience delays in very poor visibility

#### Visualization: Delays vs. Visibility

```{r}
#| fig-width: 9
#| fig-height: 6
#| warning: false
# Scatterplot: visibility vs delays (sample for performance)
set.seed(42)
ggplot(flights_weather_clean |> sample_n(10000), 
       aes(x = visib, y = dep_delay)) +
  geom_point(alpha = 0.2, color = "steelblue") +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  coord_cartesian(ylim = c(-20, 100)) +
  labs(
    title = "Departure Delays vs. Visibility",
    subtitle = "Sample of 10,000 flights with linear trend line",
    x = "Visibility (miles)",
    y = "Departure Delay (minutes)"
  ) +
  theme_minimal()
```

The scatter plot shows that lower visibility is associated with higher delays, though there is substantial variation.

## Conclusion

This analysis of the nycflights13 dataset reveals important relationships between weather conditions and flight delays:

### Key Findings

1. **Precipitation has the strongest practical impact:**
   - Heavy precipitation (>0.5 inches) results in average delays of ~49 minutes
   - This is more than 4× the average delay in dry conditions (~11 minutes)
   - Nearly 70% of flights are delayed during heavy precipitation

2. **Visibility matters:**
   - Very poor visibility (<1 mile) nearly triples average delays compared to clear conditions
   - The effect is substantial but less dramatic than precipitation

3. **Weather correlations are weak but consistent:**
   - Individual weather variables show weak correlations with delays (all <0.12)
   - However, categorical analysis reveals strong practical effects
   - This suggests weather interacts with other factors (aircraft cascading, crew scheduling, etc.)

### Practical Implications

- **For travelers**: Consider avoiding flights during periods of precipitation or poor visibility
- **For airlines**: Weather-related delays compound throughout the day, affecting multiple flights
- **For airports**: Investment in all-weather capabilities can significantly reduce delays

### Future Analysis

Potential extensions of this work could include:

- Seasonal patterns in weather-related delays
- Comparison of how different airports handle weather conditions
- Combined effects of multiple weather factors
- Impact of weather on arrival delays vs. departure delays
- Analysis of how delays propagate through the day

This analysis demonstrates that while weather is just one factor affecting flight delays, adverse conditions—particularly precipitation—have a clear and substantial impact on flight operations at New York City airports.